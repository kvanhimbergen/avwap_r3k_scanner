[Service]
# EnvironmentFile points to .env on the droplet (contains secrets; do not commit .env)
EnvironmentFile=/root/avwap_r3k_scanner/.env

# Only restart on real failures; treat stale watchlist (exit 2) as expected/clean.
Restart=on-failure
RestartPreventExitStatus=2
SuccessExitStatus=2

# ExecStart: acquire singleton lock; run gate; if ok, exec python (becomes main PID).
ExecStart=
ExecStart=/bin/bash -lc 'exec 9>/run/avwap/execution.lock; flock -n 9 || exit 0; /root/avwap_r3k_scanner/bin/check_watchlist_today.sh; rc=$?; if [ "$rc" -ne 0 ]; then exit "$rc"; fi; exec /root/avwap_r3k_scanner/venv/bin/python -u -m execution_v2.execution_main --poll-seconds 60'
